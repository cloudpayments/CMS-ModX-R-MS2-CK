# CloudKassir модуль для ModX Revolution - MiniShop2
Модуль позволяет интегрировать онлайн-кассу [CloudKassir](https://cloudkassir.ru/) в  MiniShop2 на ModX для соответствия вашего интернет магазина с  ФЗ-54. 

### Возможности
* Автоматическая отправка чеков прихода;  
* Отправка чеков возврата прихода;  
* Отдельная настройка НДС для служб доставки;  
* Отправка чеков на email клиента;  
* Отправка чеков в SMS;  

### Совместимость

* ModX Revolution v.2.5.8 и выше;  
* MiniShop2 v.2.4.12 и выше.  

_Если вы используете платежный модуль CloudPayments совместно с модулем CloudKassir, то убедитесь, что в платежном модуле отключена отправка чеков через онлайн-кассу, во избежание дублирования кассовых чеков._

### Техническая настройка
В настройках MODX (пространство имен mscloudpaymentskassa) необходимо указать следующий настройки:

**Идентификатор сайта** — id сайта из личного кабинета CloudPayments

**Секретный ключ** — Пароль API из личного кабинета CloudPayments

**ИНН** — ИНН организации, на которую зарегистрирована онлайн-касса

**Ставка НДС** — Указание ставки НДС или пустое значение, если НДС не облагается. Например 18, для НДС 18%. Все возможные значения указаны в [документации](https://cloudpayments.ru/wiki/integration/instrumenti/apikassa#nds)

**Ставка НДС для доставки** — Указание отдельной ставки НДС для доставки. Если доставка платная, то она в чеке оформляется отдельной строкой со своей ставкой НДС. Значения аналогично ставке НДС для товаров.

**Система налогообложения** — Тип системы налогообложения. Возможные значения перечислены в документации [CloudPayments](https://cloudpayments.ru/wiki/integration/instrumenti/apikassa#var)

**Игнорируемые методы оплаты** — Если для некоторых методов оплаты генерировать онлайн-чеки не требуется, то можно указать их id через запятую в этом параметре

**Статус заказа для оплаты** — id статуса заказа, при переводе в который отправляется запрос на генерацию онлайн-чека прихода. Можно указать несколько статусов через запятую

**Статус заказа для отмены** — id статуса заказа, при переводе в который отправляется запрос на генерацию онлайн-чека возврата. Можно указать несколько статусов через запятую


### Ручная Установка Модуля

1. Загрузить в любую подпапку modx (например mspCloudPayments)
2. Скопировать build.config.example.php в build.config.php
3. Поправить путь MODX_BASE_PATH в build.config.php (должен быть на корень установки modx)
4. Запустить  
`http://domain.ru/mspCloudPayments/_build/build.transport.php`
5. Пакет должен появится в списке пакетов в разделе "Управление пакетами"
